/* GptMeasurement HouseHold ImplementationValidator LegacyLayer NbcuConfig SignalsAutoInsertion SignalsBsc SignalsIds SignalsTvp SignalsVlp */
(()=>{var Wt=Object.defineProperty,ur=Object.defineProperties,cr=Object.getOwnPropertyDescriptor,gr=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var mr=Object.prototype.hasOwnProperty,pr=Object.prototype.propertyIsEnumerable;var $t=(o,t,e)=>t in o?Wt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,at=(o,t)=>{for(var e in t||(t={}))mr.call(t,e)&&$t(o,e,t[e]);if(Re)for(var e of Re(t))pr.call(t,e)&&$t(o,e,t[e]);return o},wt=(o,t)=>ur(o,gr(t)),i=(o,t)=>Wt(o,"name",{value:t,configurable:!0});var s=(o,t,e,r)=>{for(var n=r>1?void 0:r?cr(t,e):t,a=o.length-1,c;a>=0;a--)(c=o[a])&&(n=(r?c(t,e,n):c(n))||n);return r&&n&&Wt(t,e,n),n};var l=(o,t,e)=>$t(o,typeof t!="symbol"?t+"":t,e);var S=(o,t,e)=>new Promise((r,n)=>{var a=f=>{try{m(e.next(f))}catch(h){n(h)}},c=f=>{try{m(e.throw(f))}catch(h){n(h)}},m=f=>f.done?r(f.value):Promise.resolve(f.value).then(a,c);m((e=e.apply(o,t)).next())});var d={"2620":{adServerId:1391,customTracking:{}}};var Xt={queueAdRequest:i(o=>{var t;try{(t=o.callback)==null||t.call(o),o.callback=null}catch(e){}},"queueAdRequest"),defineSlot:i((o,t)=>{},"defineSlot"),adRendered:i((o,t)=>{},"adRendered"),adRemoved:i(o=>{},"adRemoved"),getTargeting:i(o=>({}),"getTargeting"),addEventListener:i((o,t)=>{},"addEventListener"),removeEventListener:i((o,t)=>{},"removeEventListener"),toggleDebugMode:i(()=>{console.log("%c[UT-DEBUG]%c Debug mode is not available for this tag.","color: red","color: intial")},"toggleDebugMode"),_debugScriptLoaded:i(()=>{},"_debugScriptLoaded")};var Jt=class Jt{constructor(){l(this,"isEntryModule",!0)}};i(Jt,"EntryModule");var I=Jt;var Lt=class Lt{constructor(t){l(this,"_error");l(this,"_message","unknown");l(this,"_trace",[]);if(t instanceof Lt)return t;t instanceof Error&&(this._error=t,this._message=t.message)}get error(){return this._error}get message(){return this._message}get trace(){return this._trace}addToTrace(t){this.trace.unshift(t)}};i(Lt,"TracedError");var Rt=Lt;var Zt=class Zt{constructor(t,e){l(this,"window");l(this,"dvtag");l(this,"modules",new Map);l(this,"errorHandlers",[]);l(this,"errors",[]);var r;this.window=e,this.window.dvtag=(r=this.window.dvtag)!=null?r:{},this.dvtag=this.window.dvtag,this.dvtag._core=this;for(let[n,a]of Object.entries(Xt))this.dvtag[n]=a;for(let n of t)this.createModule(n);for(let n of this.modules.values())this.applyModuleDecoration(n);for(let n of this.modules.values())this.applyErrorDecoration(n);for(let n of this.modules.values())this.applyPluginDecoration(n);for(let n of this.modules.values())this.applyApiDecoration(n);for(let n of this.modules.values())this.applyExecuteDecoration(n)}get moduleList(){return[...this.modules.keys()].map(t=>t.name)}get entryModuleList(){return[...this.modules.entries()].filter(([t,e])=>e instanceof I).map(([t,e])=>t.name)}get(t){return this.getModule(t).gateway}getByName(t){let e=[...this.modules.keys()].find(r=>r.name===t);return e!=null?this.get(e):null}getModule(t){let e=this.modules.get(t);if(e==null)throw new Error(`module not in core: ${t.name}`);return e}createModule(t){if(t.prototype.moduleConfig==null)throw new Error(`not a module: ${t.name}`);let e=new t;e.core=this,e.gateway={module:e},this.modules.set(t,e)}applyModuleDecoration(t){var n,a,c,m,f,h;let e=t.constructor.prototype.moduleConfig,r=t.constructor.name;for(let{method:y}of e){let st=t[y].bind(t),W=(c=(a=(n=this.dvtag._hooks)==null?void 0:n.interceptModule)==null?void 0:a[r])==null?void 0:c[y],D=W==null?st:W.bind(t),K=(h=(f=(m=this.dvtag._hooks)==null?void 0:m.inspectModule)==null?void 0:f[r])==null?void 0:h[y],Ht=K==null?D:(...It)=>{let At=D(...It);return K(It,At),At},dr=i((...It)=>{let At;try{At=Ht(...It)}catch(Dt){throw this.traceMethodError(t,y,It,Dt)}return At instanceof Promise?At.then(Dt=>Dt,Dt=>{throw this.traceMethodError(t,y,It,Dt)}):At},"traced");t.gateway[y]=dr}if(t.plugins!=null){t.pluginFunctions={};for(let y of Object.keys(t.plugins)){t.pluginFunctions[y]=[];let st=t.pluginFunctions[y];t.plugins[y]=(...W)=>{let D=[];for(let K of st)try{D.push(K(...W))}catch(Ht){this.tracePluginError(t,y,Ht)}return D}}}}traceMethodError(t,e,r,n){let a=new Rt(n);return a.addToTrace(`${t.constructor.name}.${e}(${r.map(c=>typeof c).join(",")})`),a}traceExecuteError(t){let e=new Rt(t);return e.addToTrace("@execute"),this.handleSevereError(e),e}tracePluginError(t,e,r){let n=new Rt(r);return n.addToTrace(`@plugin(${t.constructor.name}, '${e}')`),this.handleSevereError(n),n}traceApiError(t,e){let r=new Rt(e);return r.addToTrace(`@api('${t}')`),this.handleSevereError(r),r}handleSevereError(t){for(let e of this.errorHandlers)try{e(t)}catch(r){}this.errors.length>10||this.errors.push({message:t.message,trace:t.trace})}applyErrorDecoration(t){var r;let e=(r=t.constructor.prototype.errorConfig)!=null?r:[];for(let{method:n}of e)this.errorHandlers.push(t.gateway[n])}applyPluginDecoration(t){var r;let e=(r=t.constructor.prototype.pluginConfig)!=null?r:[];for(let{PluggableClass:n,category:a,method:c}of e)this.getModule(n).pluginFunctions[a].push(t.gateway[c])}applyApiDecoration(t){var r;let e=(r=t.constructor.prototype.apiConfig)!=null?r:[];for(let{api:n,method:a}of e)Object.defineProperty(this.dvtag,n,{value:i((...c)=>{var m,f;try{return t.gateway[a](...c)}catch(h){return this.traceApiError(n,h),(f=(m=Xt)[n])==null?void 0:f.call(m,...c)}},"value"),writable:!1})}applyExecuteDecoration(t){return S(this,null,function*(){var r;let e=(r=t.constructor.prototype.executeConfig)!=null?r:[];for(let{method:n}of e)try{yield t.gateway[n]()}catch(a){this.traceExecuteError(a)}})}};i(Zt,"Core");var Ut=Zt;var te=[],ee=te;var g=i(o=>{let t=o.prototype,e=Object.getOwnPropertyNames(t).filter(r=>{var n;return r!=="constructor"&&((n=Object.getOwnPropertyDescriptor(t,r))==null?void 0:n.value)instanceof Function});t.moduleConfig=e.map(r=>({method:r})),te.push(o)},"moduleClass"),N=i(o=>t=>{},"attachModule"),x=i((o,t)=>{var e;o.executeConfig=(e=o.executeConfig)!=null?e:[],o.executeConfig.push({method:t})},"executeMethod"),p=i((o,t)=>(e,r)=>{var n;e.pluginConfig=(n=e.pluginConfig)!=null?n:[],e.pluginConfig.push({PluggableClass:o,category:t,method:r})},"pluginMethod"),lt=i(o=>(t,e)=>{var r;t.apiConfig=(r=t.apiConfig)!=null?r:[],t.apiConfig.push({api:o,method:e})},"apiMethod"),ye=i((o,t)=>{var e;o.errorConfig=(e=o.errorConfig)!=null?e:[],o.errorConfig.push({method:t})},"errorMethod");var xt=i(o=>{if(o==null)return[];let t=Ee(o);return t!=null?[t]:Array.isArray(o)?o.map(Ee).filter(e=>e!=null):[]},"parseSlotSizes"),Ee=i(o=>{if(o==null)return null;if(typeof o=="string")return{label:o};if(Array.isArray(o)){if(o.length===1&&typeof o[0]=="string")return{label:o[0]};if(o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number")return{width:o[0],height:o[1]}}if(typeof o=="object"){let{label:t,width:e,height:r}=o;if(typeof e=="number"&&typeof r=="number")return{width:e,height:r};if(typeof t=="string")return{label:t}}return null},"parseSlotSize");var _e=i(o=>{try{return o.getSizes()}catch(t){return[]}},"getGptSlotSizesSafe");var Ft=i(o=>{let t=o.split("/").map(n=>n.trim()).filter(n=>n.length>0);if(t.length<2)return;let e=t[0].split(",",1)[0],r=Number(e);return Number.isNaN(r)?void 0:`${r}`},"getNetworkCodeFromAdUnit");var Qt=i((o,t)=>{let e=o.getAdUnitPath(),r=Ft(e);return{id:e,network:r,sizes:xt(_e(o)),position:o.getTargeting(t)[0]}},"gptSlotToAdUnit");var re="dvp_spos";var U=class{_getAdServers(){try{return d}catch(t){return{}}}isAdServerConfigured(t){return t!=null&&t in this._getAdServers()}getAdServerConfig(t){var e;return t==null||!this.isAdServerConfigured(t)?{}:(e=this._getAdServers()[t])!=null?e:{}}getAdServerCustomTracking(t){var e;return t==null||!this.isAdServerConfigured(t)?{}:(e=this._getAdServers()[t].customTracking)!=null?e:{}}getAdServerId(t){if(!(t==null||!this.isAdServerConfigured(t)))return this._getAdServers()[t].adServerId}getAdPositionKey(t){var e,r;return t==null?re:(r=(e=this._getAdServers()[t])==null?void 0:e.adPositionKey)!=null?r:re}};i(U,"AdServers"),U=s([g],U);var w=[];for(let o=0;o<256;++o)w.push((o+256).toString(16).slice(1));function ve(o,t=0){return(w[o[t+0]]+w[o[t+1]]+w[o[t+2]]+w[o[t+3]]+"-"+w[o[t+4]]+w[o[t+5]]+"-"+w[o[t+6]]+w[o[t+7]]+"-"+w[o[t+8]]+w[o[t+9]]+"-"+w[o[t+10]]+w[o[t+11]]+w[o[t+12]]+w[o[t+13]]+w[o[t+14]]+w[o[t+15]]).toLowerCase()}i(ve,"unsafeStringify");var ie,hr=new Uint8Array(16);function oe(){if(!ie){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ie=crypto.getRandomValues.bind(crypto)}return ie(hr)}i(oe,"rng");var Sr=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ne={randomUUID:Sr};function Tr(o,t,e){var n,a,c;if(ne.randomUUID&&!t&&!o)return ne.randomUUID();o=o||{};let r=(c=(a=o.random)!=null?a:(n=o.rng)==null?void 0:n.call(o))!=null?c:oe();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(e=e||0,e<0||e+16>t.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let m=0;m<16;++m)t[e+m]=r[m];return t}return ve(r)}i(Tr,"v4");var se=Tr;var mt=i(()=>se(),"uuid");var ae=class ae{constructor(t,e,r,n=mt(),a=Date.now()){this.adServer=t;this.elementId=e;this.adUnit=r;this.uuid=n;this.creationTime=a;l(this,"_variables",new Map)}setVariable(t,e){this._variables.set(t,e)}getVariable(t){return this._variables.get(t)}hasVariable(t){return this._variables.has(t)}clearVariable(t){this._variables.delete(t)}};i(ae,"Slot");var Ot=ae;var T=class{constructor(){l(this,"plugins",{slotDiscovered:i((t,e)=>[],"slotDiscovered"),slotDestroyed:i(t=>[],"slotDestroyed")});l(this,"_slots",{})}getSlot(t,e){var r;return(r=this._slots[t])==null?void 0:r[e]}getSlots(t){var e;if(t==null){let r=[];for(let n of Object.values(this._slots))r.push(...Object.values(n));return r}return Object.values((e=this._slots[t])!=null?e:{})}createSlot(t,e,r,n,a){var f,h;let c=this.getSlot(t,r);c!=null&&this.plugins.slotDestroyed(c);let m=new Ot(t,r,n);return(h=(f=this._slots)[t])!=null||(f[t]={}),this._slots[t][r]=m,a==null||a(m),this.plugins.slotDiscovered(m,e),m}};i(T,"SlotStore"),T=s([g],T);var le=class le{set(t,e){t.setVariable(this,e)}get(t){return t.getVariable(this)}getOrDefault(t,e){return t.hasVariable(this)?this.get(t):(this.set(t,e),e)}getOrDefaultFromFunction(t,e){if(t.hasVariable(this))return this.get(t);let r=e();return this.set(t,r),r}delete(t){t.clearVariable(this)}};i(le,"SlotVariable");var b=le;var dt=i((...o)=>{let t=[];for(let e of o)if(e!=null)for(let r of e)t.includes(r)||t.push(r);return t},"mergeUnique");var A=class{constructor(){l(this,"plugins",{getAdServerTargeting:i((t,e)=>[],"getAdServerTargeting"),setAdServerTargeting:i((t,e,r)=>[],"setAdServerTargeting")});l(this,"globalTargeting",{});l(this,"slotTargeting",new b)}_getSlotTargeting(t){var r;let e=(r=this.slotTargeting.get(t))!=null?r:{};return this.slotTargeting.set(t,e),e}_getTargetingKeys(t){return dt(Object.keys(this.globalTargeting),Object.keys(this._getSlotTargeting(t)))}_getTargetingValues(t,e){return dt(this.globalTargeting[e],this._getSlotTargeting(t)[e])}getTargeting(t){let e={};if(t==null)for(let r of Object.keys(this.globalTargeting))e[r]=[...this.globalTargeting[r]];else for(let r of this._getTargetingKeys(t))e[r]=this._getTargetingValues(t,r);return e}setSlotTargeting(t,e,r=!1){var c;let n=Object.keys(e),a=this._getSlotTargeting(t);for(let m of n)a[m]=dt(e[m],r?(c=this.slotTargeting.get(t))==null?void 0:c[m]:null);this.setAdServerTargeting(t,n)}setGlobalTargeting(t,e=!1){let r=Object.keys(t);for(let n of r)this.globalTargeting[n]=dt(t[n],e?this.globalTargeting[n]:null);for(let n of this.core.get(T).getSlots())this.setAdServerTargeting(n,r)}getAdServerTargeting(t,e){var r;return(r=this.plugins.getAdServerTargeting(t,e).find(n=>n.length!==0))!=null?r:[]}setAdServerTargeting(t,e){e==null&&(e=this._getTargetingKeys(t));for(let r of e)this.plugins.setAdServerTargeting(t,r,this._getTargetingValues(t,r))}_onSlotDiscovered(t){this.setAdServerTargeting(t)}};i(A,"TargetingHub"),s([p(T,"slotDiscovered")],A.prototype,"_onSlotDiscovered",1),A=s([g],A);var Ar=[[/((\?)|&)(?:amp_lite|fr=operanews)/g,"$2"],[/(^https?:\/\/)(www\.)/g,"$1"],[/(((\?)|&|%3F|%26|;)(?:utm_campaign|utm_source|utm_content|utm_term|utm_viral|utm_medium|utm_identifier|utm_key|fb_source|referrer|referer|ref|rand|rnd|randid|\.?rand|\.?partner|cb|count|adid|session|sessionid|session_redirect|param\d|userinfo|uid|refresh|ocid|ncid|clickenc|fbclid|amp_js_v|amp_gsa|ns_source|ns_campaign|ns_mchanel|ns_mchannel|ns_linkname|ns_fee|src|ex_cid|usqp|source|xid|trkid|utm_social-type|mbid|utm_brand|__twitter_impression|utm_referrer|CMP|cmp|_cmp|cq_cmp)=[^&]*)/g,"$3"],[/[/.]amp(?:\/[?&]*)?$/g,""],[/((\?)|&)(?:outputType|isFollow|suppressMediaBar|cid|ICID|icid|bdk|wtu_id_h|utm_placement|intcmp|_native_ads|traffic_source|entry|\.tsrc|autoplay|autostart|dc_data|influencer|pubdate|utm_hp_ref|redirect|service|refresh_ce|refresh_cens|xcmg|target_id|_amp)=[^&]*/g,"$2"],[/(\?|&)(?:amp)(?:&|$|=[^&]*)/g,"$1"]],Rr=[[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""],[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""]],be=i((o,t)=>{for(let[e,r]of o)t=t.replace(e,r);return t},"replaceByRules"),Ce=i(o=>{let t=be(Ar,o);return be(Rr,t)},"normalizeUrl");var Ie=i(o=>o.split("?",1)[0].split("#",1)[0],"stripUrlQuery");var xe=i((o,t)=>{try{let e=new URLSearchParams(o),r=e.get("ctx"),n=e.get("cmp");if(r!=null&&n!=null)return{ctx:r,cmp:n,prefetch:t,legacy:!0}}catch(e){}return null},"parseInfo"),Pe=i(o=>{var t;return o.pathname!=="/signals/pub.js"?null:(t=xe(o.search,!0))!=null?t:xe(o.hash.substring(1),!1)},"parseLegacyPagetagUrl");var yr=1e3,Er=/^\/dvtag\/([^/]+)\/([^/]+)\/pub\.js$/,_=class{constructor(){l(this,"visit");l(this,"tagInfo");l(this,"plugins",{newVisit:i(t=>[],"newVisit")});l(this,"_normalizeUrl",Ce)}_initialize(){this.getTagInfo(),this.updateVisit(!1),this.plugins.newVisit(this.visit),this._installNavigationListener()}getTagInfo(){var t;if(this.tagInfo==null){try{this.tagInfo=this._parseTagInfo()}catch(e){}(t=this.tagInfo)!=null||(this.tagInfo={ctx:"unknown",cmp:"unknown"})}return this.tagInfo}_parseTagInfo(){let t=this.getCurrentScriptSrc();if(t==null)return null;let e=new URL(t,"https://pub.doubleverify.com"),r=e.pathname,n=Er.exec(r);if(n!=null){let[,a,c]=n;return{ctx:a,cmp:c}}return Pe(e)}getCurrentScriptSrc(){var t,e;return(e=(t=this.core.window.document.currentScript)==null?void 0:t.getAttribute("src"))!=null?e:null}updateVisit(t=!0){var r,n;let e=this.getStrippedPageUrl();if(this.visit==null||this.visit.strippedUrl!==e){let a=mt();this.visit={strippedUrl:e,normalizedUrl:this._normalizeUrl(this.core.window.location.href),uuid:a,sessionUuid:(n=(r=this.visit)==null?void 0:r.sessionUuid)!=null?n:a},t&&this.plugins.newVisit(this.visit)}return this.visit}getVisit(){var t;return(t=this.visit)!=null?t:this.updateVisit(!1)}getStrippedPageUrl(){return Ie(this.core.window.location.href)}getNormalizedPageUrl(){return this.getVisit().normalizedUrl}getVisitUuid(){return this.getVisit().uuid}getSessionUuid(){return this.getVisit().sessionUuid}_installNavigationListener(){let{window:t}=this.core,e=i(()=>this.updateVisit(!0),"cb");t.navigation!=null?t.navigation.addEventListener("navigatesuccess",e):setInterval(e,yr)}};i(_,"Context"),s([x],_.prototype,"_initialize",1),_=s([g],_);var de=class de{constructor(){l(this,"pending",[]);l(this,"flushing",!1)}push(t){this.pending.push(t),this.flush()}flush(){return S(this,null,function*(){var e;if(this.flushing)return;this.flushing=!0;let t=this.pending.shift();for(;t!=null;){try{yield t.promise}catch(r){}try{(e=t.callback)==null||e.call(t)}catch(r){}t=this.pending.shift()}this.flushing=!1})}};i(de,"AsyncQueue");var Vt=de;var R=class{constructor(){l(this,"plugins",{adRequestQueued:i(t=>[],"adRequestQueued"),adRequestTimedOut:i(t=>[],"adRequestTimedOut"),adRequestBeforeRelease:i(t=>[],"adRequestBeforeRelease"),adRequestCompleted:i(t=>[],"adRequestCompleted")});l(this,"queue",new Vt);l(this,"adRequestCounter",0)}_queueAdRequest(t={}){var a,c;let e={index:this.adRequestCounter++,status:"queued",timeoutValue:(a=t.timeout)!=null?a:0,onDvtagReadyCalled:(c=t.timestamp)!=null?c:0,waitingStarted:new Date().getTime(),internal:t.internal};this.core.get(_).updateVisit(),this.plugins.adRequestQueued(e);let r=t.callback;r===void 0?t.callback=()=>{}:r===null?e.status="tag-timeout":t.callback=()=>{e.status="queue-timeout",e.callbackCalled=new Date().getTime(),t.callback=null,this.plugins.adRequestTimedOut(e);try{r()}catch(m){}};let n=i(()=>{if(t.callback!=null){t.callback=null,e.status="success",e.callbackCalled=new Date().getTime(),this.plugins.adRequestBeforeRelease(e);try{r==null||r()}catch(m){}}else this.plugins.adRequestBeforeRelease(e);e.waitingEnded=new Date().getTime(),this.plugins.adRequestCompleted(e)},"onAsyncOperationsCompleted");this.queue.push({callback:n,adRequest:e})}delayAdRequests(t){this.queue.push({promise:t})}};i(R,"AdRequestQueue"),s([lt("queueAdRequest")],R.prototype,"_queueAdRequest",1),R=s([g],R);var k=class{getShortCommitId(){return"0f471f0"}getBuildTimestamp(){return 1741780825474}getAuthToken(){return"9Nt0lK8kIe4j66wY5uia4ddj2FXbCjeTVMzOmgbMEVQl4tLJP/ABVG1XxsRTGfC3ijCsIoCYwNnUqmqQAss3OEBiGlxVyfoLA6o5mTe5jfLFmLMed6lpww4ukbw2hQaGE1NyglZrFAb1/KYcT9Asnig="}};i(k,"DefinedVariables"),k=s([g],k);var Q=class{constructor(){l(this,"cache",{})}_performFetchJson(t,e){return S(this,null,function*(){let r=t;if(e!=null&&e.authToken){let c=this.core.get(k).getAuthToken(),m=new URL(t);m.searchParams.set("token",c),r=m.href}let n=yield this.core.window.fetch(r);return{json:yield n.json(),headers:n.headers}})}fetchJson(t,e){return S(this,null,function*(){let r=this.cache[t];return r==null&&(r=this._performFetchJson(t,e).then(n=>n.json),this.cache[t]=r),r})}};i(Q,"Fetch"),Q=s([g],Q);var qt=["BSC","ABS","CCT","CBS"],ue=["IDS"],Nt=["VLP","TVP"],vr=[...qt,...ue,...Nt],_s=[...qt,...ue,...Nt].filter(o=>o!=="CCT"),De=i(o=>vr.includes(o.toUpperCase()),"isSignal"),we=i(o=>Nt.includes(o.toUpperCase()),"isSlotSignal"),Ue=i(o=>ue.includes(o.toUpperCase()),"isUserSignal"),Oe=i(o=>qt.includes(o.toUpperCase()),"isPageSignal");var Gt=i(o=>o==null?"":`@${o}`,"getPositionSuffix");var br=/^(\d+)x(\d+)$/,qe=i(o=>o==="all"?[]:o.split(",").map(t=>{let e=t.match(br);return e==null?{label:t}:{width:parseInt(e[1],10),height:parseInt(e[2],10)}}),"stringToSlotSizes"),ce=i(o=>o.length===0?"all":o.map(({width:t,height:e,label:r})=>r!=null?r:`${t}x${e}`).join(","),"slotSizesToString"),Ne=i(o=>o==null?"":o.length>0&&o.every(({label:r})=>r==null)?ce(o):"","slotSizesToStringIfSpecific");var Cr="https://pub.doubleverify.com/dvtag/signals/",V=class{_getBaseUrl(t){let e=this.core.get(_),{ctx:r,cmp:n}=e.getTagInfo(),a=e.getNormalizedPageUrl();try{a=new URL(a).origin}catch(m){}let c=new URL(t,Cr);return c.searchParams.set("ctx",r),c.searchParams.set("cmp",n),c.searchParams.set("url",a),c}getUserTargetingUrl(t){let e=this._getBaseUrl("ids/pub.json");return t.includes("IDS")&&e.searchParams.set("ids","1"),e.href}getPageTargetingUrl(t,e){let r=this._getBaseUrl("bsc/pub.json");return r.searchParams.set("url",e),t.includes("BSC")&&r.searchParams.set("bsc","1"),t.includes("ABS")&&r.searchParams.set("abs","1"),t.includes("CBS")&&r.searchParams.set("cbs","1"),t.includes("CCT")&&r.searchParams.set("cct","1"),r.href}getSlotTargetingUrl(t,e){var a;let r=this._getBaseUrl("vlp/pub.json");t.includes("VLP")&&r.searchParams.set("vlp","1"),t.includes("TVP")&&r.searchParams.set("tvp","1");let n=0;for(let c of e){let{id:m,position:f,sizes:h}=(a=c.adUnit)!=null?a:{},y=m+Gt(f);r.searchParams.set(`slot-${n++}-${y}`,Ne(h))}return r.href}};i(V,"SignalsUrlBuilder"),V=s([g],V);var pt=class{constructor(){l(this,"cache",{})}_fetchFreshSignals(t,e){return S(this,null,function*(){if(!e.some(Oe))return{};let r=this.core.get(V).getPageTargetingUrl(e,t),n;try{n=yield this.core.get(Q).fetchJson(r,{authToken:!0})}catch(a){return{}}return n instanceof Object?n:{}})}fetchSignals(t,e=3){return S(this,null,function*(){let r=this.core.get(_),n=r.getNormalizedPageUrl(),a=r.getStrippedPageUrl();this.cache[a]==null&&(this.cache[a]=this._fetchFreshSignals(n,t));let c=yield this.cache[a];return this.core.get(_).getStrippedPageUrl()!==a&&e>0?this.fetchSignals(t,e-1):c})}};i(pt,"PageSignals"),pt=s([g],pt);var ft=class{constructor(){l(this,"cache",{});l(this,"pendingSlots",[]);l(this,"pendingBulkRequest",null)}_scheduleBulkRequest(t){return S(this,null,function*(){yield Promise.resolve();let e=this.core.get(V).getSlotTargetingUrl(t,this.pendingSlots);this.pendingSlots=[],this.pendingBulkRequest=null;let r;try{r=yield this.core.get(Q).fetchJson(e,{authToken:!0})}catch(n){return[]}return r})}_fetchFreshSignals(t,e){return S(this,null,function*(){if(!e.some(we))return{};let r=this.pendingSlots.push(t)-1;this.pendingBulkRequest==null&&(this.pendingBulkRequest=this._scheduleBulkRequest(e));let a=(yield this.pendingBulkRequest)[r];return a instanceof Object?a:{}})}_getCacheKey(t){var m,f;let{id:e,position:r,sizes:n}=(m=t.adUnit)!=null?m:{},a=e+Gt(r),c=(f=n==null?void 0:n.map(h=>{var y;return(y=h.label)!=null?y:`${h.width}x${h.height}`}).sort().join(","))!=null?f:"";return`${a}#${c}`}fetchSignals(t,e){return S(this,null,function*(){let r=this._getCacheKey(t);return this.cache[r]==null&&(this.cache[r]=this._fetchFreshSignals(t,e)),this.cache[r]})}};i(ft,"SlotSignals"),ft=s([g],ft);var ht=class{constructor(){l(this,"cache")}_fetchFreshSignals(t){return S(this,null,function*(){if(!t.some(Ue))return{};let e=this.core.get(V).getUserTargetingUrl(t),r;try{r=yield this.core.get(Q).fetchJson(e,{authToken:!0})}catch(n){return{}}return r instanceof Object?r:{}})}fetchSignals(t){return S(this,null,function*(){return this.cache==null&&(this.cache=this._fetchFreshSignals(t)),this.cache})}};i(ht,"UserSignals"),ht=s([g],ht);var E=class{constructor(){l(this,"plugins",{getEnabledSignals:i(()=>[],"getEnabledSignals"),userTargetingUpdated:i(t=>[],"userTargetingUpdated"),pageTargetingUpdated:i(t=>[],"pageTargetingUpdated"),slotTargetingUpdated:i((t,e)=>[],"slotTargetingUpdated")});l(this,"dataForMigrationTracking",{userTargeting:{},pageTargeting:{},slotTargeting:new Map})}getEnabledSignals(){return this.plugins.getEnabledSignals()}getDataForMigrationTracking(){return this.dataForMigrationTracking}_initialize(){this.getUserTargeting(),this.getPageTargeting()}_onAdRequestQueued(){this.getPageTargeting()}_onSlotDiscovered(t){this.getSlotTargeting(t)}getUserTargeting(){return S(this,null,function*(){let t=this._fetchUserTargeting();return this.core.get(R).delayAdRequests(t),t})}getPageTargeting(){return S(this,null,function*(){let t=this._fetchPageTargeting();return this.core.get(R).delayAdRequests(t),t})}getSlotTargeting(t){return S(this,null,function*(){let e=this._fetchSlotTargeting(t);return this.core.get(R).delayAdRequests(e),e})}_fetchUserTargeting(){return S(this,null,function*(){let t=yield this.core.get(ht).fetchSignals(this.getEnabledSignals());return this.core.get(A).setGlobalTargeting(t),this.dataForMigrationTracking.userTargeting=t,this.plugins.userTargetingUpdated(t),t})}_fetchPageTargeting(){return S(this,null,function*(){let t=yield this.core.get(pt).fetchSignals(this.getEnabledSignals());return this.core.get(A).setGlobalTargeting(t),this.dataForMigrationTracking.pageTargeting=t,this.plugins.pageTargetingUpdated(t),t})}_fetchSlotTargeting(t){return S(this,null,function*(){let e=yield this.core.get(ft).fetchSignals(t,this.getEnabledSignals());return this.core.get(A).setSlotTargeting(t,e),this.dataForMigrationTracking.slotTargeting.set(t,e),this.plugins.slotTargetingUpdated(t,e),e})}};i(E,"Signals"),s([x],E.prototype,"_initialize",1),s([p(R,"adRequestQueued")],E.prototype,"_onAdRequestQueued",1),s([p(T,"slotDiscovered")],E.prototype,"_onSlotDiscovered",1),E=s([g],E);var G=class{constructor(){l(this,"pq",null)}getPq(){return this.pq==null&&(this.pq=this._initialize()),this.pq}getPts(){return this.getPq().PTS}setApi(t){let e=this.getPq();e!=null&&(e.init=()=>{},e.loadSignals=t.loadSignals,e.loadSignalsForSlots=t.loadSignalsForSlots,e.getTargeting=t.getTargeting)}_pushToDvtagCmd(...t){var e;this.core.dvtag.cmd=(e=this.core.dvtag.cmd)!=null?e:[],this.core.dvtag.cmd.push(...t)}_initialize(){var r,n;this.core.window.PQ=(r=this.core.window.PQ)!=null?r:{};let t=this.core.window.PQ;if(t.loaded)return{cmd:[],PTS:{}};t.loaded=!0,t.PTS=(n=t.PTS)!=null?n:{};let e=t.cmd;return t.cmd={push:i(a=>this._pushToDvtagCmd(a),"push")},Array.isArray(e)&&this._pushToDvtagCmd(...e),t}};i(G,"LegacyPq"),G=s([g],G);var Me=i(o=>{var r,n,a;let t=mt(),e={id:(n=(r=o.adUnitPath)!=null?r:o.invCode)!=null?n:o.tagId,sizes:xt(qe((a=o.sizes)!=null?a:"all")),position:o.position};return{elementId:t,adUnit:e}},"parseLegacyAdUnit");var ke=i((o,t)=>{var n;let e=(n=o.IDS)==null?void 0:n[0];if(e==null)return;let r=parseInt(e);isNaN(r)||(t.IDS=r)},"setUserTargetingOnPts"),Le=i((o,t)=>{for(let e of qt)o[e]!=null&&(t[e]=o[e])},"setPageTargetingOnPts"),Fe=i((o,t,e)=>{var m,f,h,y,st,W;let{adUnit:r}=o;if((r==null?void 0:r.id)==null)return;let n=r.id,a=ce((m=r.sizes)!=null?m:[]),c=r.position;for(let D of Nt){let K=t[D];K!=null&&((f=e[D])!=null||(e[D]={}),(y=(h=e[D])[n])!=null||(h[n]={}),e[D][n][a]=K[0],c!=null&&((W=(st=e[D][n])[c])!=null||(st[c]={}),e[D][n][c][a]=K[0]))}},"setSlotTargetingOnPts");var X=class extends I{_initialize(){this.core.get(G).setApi({loadSignals:this.loadSignals.bind(this),loadSignalsForSlots:this.loadSignalsForSlots.bind(this),getTargeting:this.getTargeting.bind(this)})}_setUserTargetingOnPts(t){let e=this.core.get(G).getPts();ke(t,e)}_setPageTargetingOnPts(t){let e=this.core.get(G).getPts();Le(t,e)}_setSlotTargetingOnPts(t,e){let r=this.core.get(G).getPts();Fe(t,e,r)}loadSignals(t,e){return S(this,null,function*(){yield this._onDvtagReady("loadSignals",e)})}loadSignalsForSlots(t,e,r){return S(this,null,function*(){let n=this.core.get(E),a=this.core.get(T);for(let m of t){let f=m.getSlotElementId(),h=a.getSlot("gpt",f);if(h==null){let y=this.core.get(U).getAdPositionKey(m.getAdUnitPath());h=a.createSlot("gpt",0,f,Qt(m,y))}n.getSlotTargeting(h)}let c=typeof e=="function"?e:r;yield this._onDvtagReady("loadSignalsForSlots",c)})}getTargeting(t,e){return S(this,null,function*(){var c;let r=this.core.get(E),n=this.core.get(T);for(let m of(c=t.adUnits)!=null?c:[]){let{elementId:f,adUnit:h}=Me(m),y=n.createSlot("legacy-api",0,f,h);r.getSlotTargeting(y)}let a=i(()=>e==null?void 0:e(void 0,this.core.get(G).getPts()),"callback");yield this._onDvtagReady("getTargeting",a)})}_getPubAdsTargeting(t){var e,r,n;return(n=(r=(e=this.core.window.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e).getTargeting(t))!=null?n:[]}_onDvtagReady(t,e){return S(this,null,function*(){yield new Promise(r=>{this.core.window.dvtag.queueAdRequest({callback:i(()=>{try{e==null||e()}catch(n){}r()},"callback"),timestamp:new Date().getTime(),timeout:750,internal:!0})})})}};i(X,"LegacyLayer"),s([x],X.prototype,"_initialize",1),s([p(E,"userTargetingUpdated")],X.prototype,"_setUserTargetingOnPts",1),s([p(E,"pageTargetingUpdated")],X.prototype,"_setPageTargetingOnPts",1),s([p(E,"slotTargetingUpdated")],X.prototype,"_setSlotTargetingOnPts",1),X=s([g],X);var Et=class extends I{_getEnabledSignals(){return"IDS"}};i(Et,"SignalsIds"),s([p(E,"getEnabledSignals")],Et.prototype,"_getEnabledSignals",1),Et=s([g],Et);var _t=class extends I{_getEnabledSignals(){return"BSC"}};i(_t,"SignalsBsc"),s([p(E,"getEnabledSignals")],_t.prototype,"_getEnabledSignals",1),_t=s([g],_t);var vt=class extends I{_getEnabledSignals(){return"VLP"}};i(vt,"SignalsVlp"),s([p(E,"getEnabledSignals")],vt.prototype,"_getEnabledSignals",1),vt=s([g],vt);var bt=class extends I{_getEnabledSignals(){return"TVP"}};i(bt,"SignalsTvp"),s([p(E,"getEnabledSignals")],bt.prototype,"_getEnabledSignals",1),bt=s([g],bt);var C=class{getWindow(){return this.core.window}getDocument(){return this.getWindow().document}getUserAgent(){var t,e;return(e=(t=this.getWindow().navigator)==null?void 0:t.userAgent)!=null?e:""}getPageUrl(){var t,e;return(e=(t=this.getWindow().location)==null?void 0:t.href)!=null?e:""}getHostname(){return new URL(this.getPageUrl()).hostname}getNavigator(){return this.getWindow().navigator}getPerformance(){var t;return(t=this.getWindow().performance)!=null?t:{}}getPerformanceTimeMs(){var t,e,r;return Math.floor((r=(e=(t=this.getPerformance()).now)==null?void 0:e.call(t))!=null?r:null)}isInQuirksMode(){return this.getDocument().compatMode==="BackCompat"}getDOMParser(){let t=this.getWindow().DOMParser;return new t}};i(C,"Environment"),C=s([g],C);var Qe={gpt:"google_ads_iframe_",ast:"utif_"},St=class{_getIframeDocument(t){try{return t.contentDocument}catch(e){return null}}_isIframeSameOrigin(t,e){if(e==null)return!1;if(t.src===""||t.src==="about:blank")return!0;let r=this.core.get(C).getPageUrl();try{return new URL(t.src).origin===new URL(r).origin}catch(n){return!1}}_findIframe(t,e){if(Qe[e]==null)return null;let n=t.querySelectorAll(`iframe[id^="${Qe[e]}"]`);return n.length===1?n[0]:null}getAdContainer(t,e){if((e==null?void 0:e.type)!=="display")return{};let{elementId:r,adServer:n}=t,c=this.core.get(C).getDocument().getElementById(r);if(c==null)return{};let m=this._findIframe(c,n);if(m==null)return{slotElement:c};let f=this._getIframeDocument(m);return this._isIframeSameOrigin(m,f)?{slotElement:c,sameOriginIframe:m,sameOriginIframeDocument:f}:{slotElement:c,crossOriginIframe:m}}};i(St,"AdLocator"),St=s([g],St);var J=class{constructor(){l(this,"plugins",{adRemoved:i(t=>[],"adRemoved")})}_monitorAdRemoval(t){let e=this.core.get(C).getDocument().getElementById(t.elementId);if(e==null)return;new MutationObserver(n=>{let a=n.length,c=0,m=e.children.length;for(let f=n.length-1;f>=0;f--){let h=n[f];if(m===0){this.plugins.adRemoved(t);break}if(c===a-1)break;let y=h.removedNodes.length-h.addedNodes.length;m+=y,c++}}).observe(e,{childList:!0})}_onSlotDestroyed(t){this.plugins.adRemoved(t)}};i(J,"AdRemoved"),s([p(T,"slotDiscovered")],J.prototype,"_monitorAdRemoval",1),s([p(T,"slotDestroyed")],J.prototype,"_onSlotDestroyed",1),J=s([g],J);var v=class{constructor(){l(this,"adEmpty",new b);l(this,"adRequestInFlight",new b);l(this,"nonEmptyAdResponses",new b);l(this,"plugins",{adRequested:i(t=>[],"adRequested"),adRequestedOrInferred:i(t=>[],"adRequestedOrInferred"),adRendered:i((t,e,r)=>[],"adRendered"),adRemoved:i(t=>[],"adRemoved")})}setAdRequested(t){this.adRequestInFlight.set(t,!0),this.plugins.adRequested(t),this.plugins.adRequestedOrInferred(t)}setAdRendered(t,e){this.adRequestInFlight.get(t)!==!0&&this.plugins.adRequestedOrInferred(t),this._setAdRemoved(t),this.adEmpty.set(t,!1),this.adRequestInFlight.set(t,!1),e!=null&&this.nonEmptyAdResponses.set(t,this.nonEmptyAdResponses.getOrDefault(t,0)+1);let r=this.core.get(St).getAdContainer(t,e);this.plugins.adRendered(t,e,r)}_setAdRemoved(t){this.adEmpty.get(t)===!1&&(this.adEmpty.set(t,!0),this.plugins.adRemoved(t))}getNonEmptyAdRenderedCount(t){return this.nonEmptyAdResponses.getOrDefault(t,0)}};i(v,"AdServerHub"),s([p(J,"adRemoved")],v.prototype,"_setAdRemoved",1),v=s([g],v);var jt=i(o=>{if(typeof o=="string"||Array.isArray(o)&&o.length===2&&o.every(t=>typeof t=="number"))return o;if(o!=null&&typeof o.width=="number"&&typeof o.height=="number")return[o.width,o.height]},"cleanSizeInput");var L=i(o=>{if(typeof o=="string")return o;if(typeof o=="number")return`${o}`},"cleanStringInput");var B=class{getPubAds(){var e,r;let t=this.core.get(C).getWindow();try{return(r=(e=t.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e)}catch(n){return}}onPubAdsReady(t){var n,a,c,m;let e=this.core.get(C).getWindow();e.googletag=(n=e.googletag)!=null?n:{},e.googletag.cmd=(a=e.googletag.cmd)!=null?a:[];let r=this.getPubAds();if(r!=null)t(r);else try{(m=(c=e.googletag.cmd)==null?void 0:c.push)==null||m.call(c,()=>{r=this.getPubAds(),r!=null&&t(r)})}catch(f){}}};i(B,"GoogletagPubAds"),B=s([g],B);var F=class{constructor(){l(this,"gptReference",new b)}_scanForSlots(){this.core.get(B).onPubAdsReady(t=>{t.getSlots().map(e=>this.maybeDiscoverSlot(e,0))})}getGptSlot(t){return this.gptReference.get(t)}maybeDiscoverSlot(t,e){let r=this.core.get(T).getSlot("gpt",t.getSlotElementId());return r==null||this.gptReference.get(r)!==t?this._createSlot(t,e):r}_createSlot(t,e){let r=t.getSlotElementId(),n=t.getAdUnitPath(),a=Ft(n),c=this.core.get(U).getAdPositionKey(a),m=Qt(t,c);return this.core.get(T).createSlot("gpt",e,r,m,h=>this.gptReference.set(h,t))}};i(F,"GoogletagSlots"),s([x,p(R,"adRequestQueued")],F.prototype,"_scanForSlots",1),F=s([g],F);var Z=class{constructor(){l(this,"plugins",{adRequested:i(t=>[],"adRequested"),adRendered:i((t,e)=>[],"adRendered")})}_getHtmlSafe(t){var e,r;try{return(r=(e=t.getHtml)==null?void 0:e.call(t))!=null?r:void 0}catch(n){return}}_initialize(){this.core.get(B).onPubAdsReady(t=>{t.addEventListener("slotRequested",e=>{let r=this.core.get(F).maybeDiscoverSlot(e.slot,1);this.plugins.adRequested(r)}),t.addEventListener("slotRenderEnded",e=>{let r=this.core.get(F).maybeDiscoverSlot(e.slot,2);if(e.isEmpty){this.plugins.adRendered(r,null);return}let n={type:"display",advertiserId:L(e.advertiserId),campaignId:L(e.campaignId),creativeId:L(e.creativeId),lineItemId:L(e.lineItemId),renderedSize:jt(e.size),html:this._getHtmlSafe(e.slot)};this.plugins.adRendered(r,n)})})}};i(Z,"GoogletagEvents"),s([x],Z.prototype,"_initialize",1),Z=s([g],Z);var me=i(o=>typeof o=="string"||typeof o=="number"?[`${o}`]:o instanceof Array?dt(o.filter(t=>typeof t=="string"||typeof t=="number").map(t=>`${t}`)):[],"cleanTargetingInput");var ut=class{getAdServerTargeting(t,e){var a,c,m;if(t.adServer!=="gpt")return[];let r=[];try{r=me((c=(a=this.core.get(B).getPubAds())==null?void 0:a.getTargeting)==null?void 0:c.call(a,e))}catch(f){}let n=[];try{n=me((m=this.core.get(F).getGptSlot(t))==null?void 0:m.getTargeting(e))}catch(f){}return dt(r,n)}setAdServerTargeting(t,e,r){var n;if(t.adServer==="gpt")try{(n=this.core.get(F).getGptSlot(t))==null||n.setTargeting(e,r)}catch(a){}}};i(ut,"GoogletagTargeting"),ut=s([g],ut);var M=class{_onAdRequested(t){this.core.get(v).setAdRequested(t)}_onAdRendered(t,e){this.core.get(v).setAdRendered(t,e)}_getAdServerTargeting(t,e){return t.adServer!=="gpt"?[]:this.core.get(ut).getAdServerTargeting(t,e)}_setAdServerTargeting(t,e,r){t.adServer==="gpt"&&this.core.get(ut).setAdServerTargeting(t,e,r)}};i(M,"Googletag"),s([p(Z,"adRequested")],M.prototype,"_onAdRequested",1),s([p(Z,"adRendered")],M.prototype,"_onAdRendered",1),s([p(A,"getAdServerTargeting")],M.prototype,"_getAdServerTargeting",1),s([p(A,"setAdServerTargeting")],M.prototype,"_setAdServerTargeting",1),M=s([g],M);var Ir="https://vtrk.doubleverify.com",Ve="dvtag",xr=1,Pr=1,O=class{constructor(){l(this,"sharedDataPoints")}_onAdRequestCompleted(t){if(t.index!==0)return;let{timeoutValue:e,onDvtagReadyCalled:r,callbackCalled:n}=t,a=n!=null?n-r:e;this.fireEvent("ad-request",{cd111:t.status,cm106:t.index,cm107:a,cd112:t.internal?"legacy":"modern"},{sampleInterval:Pr})}_handleError(t){this.fireEvent("log",{cd111:"error",cd112:t.message,cd113:t.trace.join("=>")},{sampleInterval:xr})}_getSharedDataPoints(){if(this.sharedDataPoints==null){let t=this.core.get(_),e=this.core.get(k),r=this.core.get(C),{ctx:n,cmp:a,legacy:c}=t.getTagInfo(),m=r.getHostname(),f=t.getSessionUuid(),h=e.getShortCommitId();this.sharedDataPoints={cd102:h,cd103:"",cd107:f,cd109:c?"legacy":"modern",cd108:"",cd105:n,cd106:a,cd104:m}}return this.sharedDataPoints}fireEvent(t,e,{sampleInterval:r=1,trackerUuid:n=mt(),spoofWrapperId:a=!1}={}){if(Math.random()>=1/r)return;e=wt(at(at({},e),this._getSharedDataPoints()),{cd101:t,cm101:r});let c=wt(at({ec:Ve,ea:e.cd101,ctx:a?Ve:e.cd105,cmp:e.cd106},e),{cid:n,t:"event",v:1,z:n,cd160:n}),m=new URL(Ir);for(let[f,h]of Object.entries(c))h!=null&&m.searchParams.set(f,`${h}`);this._sendBeacon(m.href)}_sendBeacon(t){try{typeof(navigator==null?void 0:navigator.sendBeacon)=="function"?navigator.sendBeacon(t):new Image().src=t}catch(e){}}};i(O,"Events"),s([p(R,"adRequestCompleted")],O.prototype,"_onAdRequestCompleted",1),s([ye],O.prototype,"_handleError",1),O=s([g],O);var Dr=.01,z=class{constructor(){l(this,"plugins",{overrideActivationRate:i(()=>[],"overrideActivationRate")});l(this,"_random",Math.random);l(this,"_falconEnabled")}isFalconEnabled(){var t;if(this._falconEnabled==null){let e=(t=this.plugins.overrideActivationRate()[0])!=null?t:Dr;this._falconEnabled=this._random()<e}return this._falconEnabled}};i(z,"FalconTest"),z=s([g],z);var H=class{constructor(){l(this,"_count",0);l(this,"plugins",{onCountUpdated:i(t=>[],"onCountUpdated")})}getCount(){return this._count}increment(){this._count+=1,this.plugins.onCountUpdated(this._count)}decrement(){this._count-=1,this.plugins.onCountUpdated(this._count)}};i(H,"MeasurementScriptCounter"),H=s([g],H);var wr="blockingtime",Ur=5*60*1e3,Or=60*1e3,qr=20;var tt=class{constructor(){l(this,"trackerCount",0);l(this,"monitorStart",0);l(this,"lastAvgScriptCountUpdate",0);l(this,"summedBlockingTime",0);l(this,"totalLongTaskTime",0);l(this,"longTaskCount",0);l(this,"avgScriptCountNumerator",0);l(this,"currentScriptCount",0);l(this,"lastTrackerSent",0);l(this,"scriptInsertions",0);l(this,"scriptFlavor","?");l(this,"observer");l(this,"visibilityListener",i(()=>{this.core.window.document.hidden&&this._sendTracker()},"visibilityListener"));l(this,"finalTrackerTimeout")}_initialize(){var n;let{PerformanceObserver:t,setTimeout:e,addEventListener:r}=this.core.window;this.scriptFlavor=this.core.get(z).isFalconEnabled()?"falcon":"cdn",!(t==null||!((n=t.supportedEntryTypes)!=null&&n.includes("longtask")))&&(this.observer=new t(a=>a.getEntries().forEach(c=>{let m=Math.max(0,c.duration-50);this.totalLongTaskTime+=c.duration,this.longTaskCount+=1,this.summedBlockingTime+=m})),this.observer.observe({type:"longtask",buffered:!0}),this.monitorStart=Date.now(),this.lastAvgScriptCountUpdate=Date.now(),r("visibilitychange",this.visibilityListener),this.finalTrackerTimeout=e(()=>{this._sendTracker(),this.disable()},Ur))}_onScriptCountUpdate(t){this.scriptInsertions+=t>this.currentScriptCount?1:0,this._updateAvgScriptCount(),this.currentScriptCount=t}_updateAvgScriptCount(){this.avgScriptCountNumerator+=this.currentScriptCount*(Date.now()-this.lastAvgScriptCountUpdate),this.lastAvgScriptCountUpdate=Date.now()}_sendTracker(){if(Date.now()-this.lastTrackerSent<Or)return;this._updateAvgScriptCount();let t=Date.now()-this.monitorStart,e={cd110:this.scriptFlavor,cm106:this.trackerCount,cm107:t,cm108:this.summedBlockingTime,cm109:this.totalLongTaskTime,cm110:this.longTaskCount,cm111:this.avgScriptCountNumerator/t,cm112:this.scriptInsertions};this.core.get(O).fireEvent(wr,e,{spoofWrapperId:!0}),this.trackerCount+=1,this.lastTrackerSent=Date.now(),this.trackerCount>=qr&&this.disable()}disable(){var r;let{removeEventListener:t,clearTimeout:e}=this.core.window;(r=this.observer)==null||r.disconnect(),t("visibilitychange",this.visibilityListener),e(this.finalTrackerTimeout)}};i(tt,"BlockingTimeMonitor"),s([x],tt.prototype,"_initialize",1),s([p(H,"onCountUpdated")],tt.prototype,"_onScriptCountUpdate",1),tt=s([g],tt);var Ge=i((o,t,e="")=>{if(o.length<=t)return o;let r=t-e.length;return r<0?e:o.slice(0,r)+e},"truncate");var Be="https://cdn.doubleverify.com/dvtp_src.js",je="https://cdn.dv.tech/dvbm.js",Ye=["btreg"];var Ke={cmp:"cmp",ctx:"ctx",isSellerTag:"seltag",blocking:"blk",t2te:"t2te",deepIFrameClickHandlers:"dich",measurementActivationPath:"dvp_pubaap",unityTagBuildTimestamp:"dvp_uptbts",unityTagBuildCommitId:"dvp_uptbcid",adServerCode:"adsrv",adServerId:"dvp_gptmasid",pageVisitId:"dvp_uptpid",slotId:"dvp_uptsid",slotElementId:"dvp_uptseid",selectedVariation:"dvp_gptmvr",selectedVariationFraction:"dvp_gptmvrfr",customDimension1:"c1",customDimension2:"c2",customDimension3:"c3",customDimension4:"c4",customDimension5:"c5",customDimension6:"c6",customDimension7:"c7",customDimension8:"c8",customDimension9:"c9",customDimension10:"c10",adPosition:"spos",qtPageId:"dvp_qtpid",qtSlotId:"dvp_qtsid",headerBidding:"dvp_gptmhb",advertiserId:"sadv",orderId:"ord",lineItemId:"litm",creativeId:"scrt",placementCode:"splc",size:"unit",slotAdCount:"dvp_uptsacnt",locatedElementType:"dvp_gptmle",adLocationMechanism:"alm",btreg:"btreg",btattb:"btattb",bttag:"bttag",btadsrv:"btadsrv",detectedAdFormats:"dvp_pubdaf",adTargetingError:"dvp_pubate",creativeWrapperAvailable:"dvp_gptmcw",isFalconTestEnabledDVP:"dvp_pubaft",isFalconTestEnabledEE:"ee_dp_pubaft",measurementInjectionStrategy:"dvp_gptmit"};var P=class{constructor(){l(this,"parameters",new b);l(this,"_truncate",Ge)}_set(t,e){Object.assign(this.parameters.getOrDefault(t,{}),e)}_getScriptUrl(t){let e=[],r=this.parameters.getOrDefault(t,{});for(let[n,a]of Object.entries(r)){let c=Ke[n];a!=null&&e.push([c,Ye.includes(c)?`${a}`:encodeURIComponent(a)])}return`${this.core.get(z).isFalconEnabled()?je:Be}#${e.map(([n,a])=>`${n}=${a}`).join("&")}`}createScriptElement(t,e){var c,m;let r=this._getScriptUrl(t),a=this.core.get(C).getDocument().createElement("script");return a.setAttribute("src",r),a.setAttribute("async",""),a.dvAdElement=(m=(c=e.sameOriginIframe)!=null?c:e.crossOriginIframe)!=null?m:e.slotElement,a}setIdentifiers(t){let{ctx:e,cmp:r}=this.core.get(_).getTagInfo();this._set(t,{ctx:e,cmp:r})}setConstants(t){this._set(t,{isSellerTag:1,t2te:0,blocking:this.core.get(z).isFalconEnabled()?0:void 0,measurementActivationPath:2,deepIFrameClickHandlers:1,unityTagBuildTimestamp:this.core.get(k).getBuildTimestamp(),unityTagBuildCommitId:this.core.get(k).getShortCommitId()})}setAdUnit(t){t.adServer==="gpt"&&this._set(t,{adServerCode:"104"}),t.adServer==="ast"&&this._set(t,{adServerCode:"90"}),this._set(t,{adServerId:this.core.get(U).getAdServerId(t.adUnit.network),pageVisitId:this.core.get(_).getVisitUuid(),slotId:t.uuid,slotElementId:this._truncate(t.elementId,30,"~")})}_getCustomDimension(t,e){var a;let n=(a=this.core.get(U).getAdServerCustomTracking(t.adUnit.network)[e])==null?void 0:a.key;return n!=null?this.core.get(A).getAdServerTargeting(t,n).join(","):void 0}setCustomDimensions(t){this._set(t,{customDimension1:this._getCustomDimension(t,"c1"),customDimension2:this._getCustomDimension(t,"c2"),customDimension3:this._getCustomDimension(t,"c3"),customDimension4:this._getCustomDimension(t,"c4"),customDimension5:this._getCustomDimension(t,"c5"),customDimension6:this._getCustomDimension(t,"c6"),customDimension7:this._getCustomDimension(t,"c7"),customDimension8:this._getCustomDimension(t,"c8"),customDimension9:this._getCustomDimension(t,"c9"),customDimension10:this._getCustomDimension(t,"c10")})}_getAdPosition(t){let e=this.core.get(U).getAdPositionKey(t.adUnit.network);return this.core.get(A).getAdServerTargeting(t,e)[0]}setQualityTargeting(t){this._set(t,{adPosition:this._getAdPosition(t),qtPageId:this.core.get(_).getVisitUuid(),qtSlotId:t.uuid})}_sizeToString(t){return Array.isArray(t)?`${t[0]}x${t[1]}`:t}setAdInstance(t,e){this._set(t,{advertiserId:e.advertiserId,orderId:e.campaignId,lineItemId:e.lineItemId,creativeId:e.creativeId,placementCode:t.adUnit.id,size:this._sizeToString(e.renderedSize)})}setEngagement(t){this._set(t,{slotAdCount:this.core.get(v).getNonEmptyAdRenderedCount(t)})}_getLocatedElementType(t){let{sameOriginIframe:e,crossOriginIframe:r}=t;return e!=null?1:r!=null?2:0}setAdLocation(t,e){this._set(t,{locatedElementType:this._getLocatedElementType(e),adLocationMechanism:"manual"})}setCustomAdFormat(t,e){e!=null&&this._set(t,at({adLocationMechanism:void 0},e))}setDebug(t){this._set(t,{isFalconTestEnabledDVP:1,isFalconTestEnabledEE:1,measurementInjectionStrategy:0})}};i(P,"MeasurementScript"),P=s([g],P);var ct=class{constructor(){l(this,"iframeElements",new b)}_applyDebugInfo(t,e){e.setAttribute("id",`gptm-${t.elementId}`),e.dataset.slotId=t.uuid,e.dataset.slotAdCount=`${this.core.get(v).getNonEmptyAdRenderedCount(t)}`}injectScriptElement(t,e){let r=this.core.get(C).getDocument(),n=r.createElement("iframe");this.iframeElements.set(t,n),this._applyDebugInfo(t,n),n.style.display="none",n.addEventListener("load",()=>{var a;(a=n.contentDocument)==null||a.body.appendChild(e)}),r.body.appendChild(n)}removeScriptElement(t){var e;try{(e=this.iframeElements.get(t))==null||e.remove(),this.iframeElements.delete(t)}catch(r){}}};i(ct,"MeasurementScriptInjection"),ct=s([g],ct);var ze=i((o,t)=>o.filter(e=>e.detect(t)),"detectAdFormats");var He=i((o,t)=>{let e=null,r=[],n=0;t!=null&&(r=ze(o,t),r.length===1&&(e=r[0].target(t))),e==null&&(t==null&&(n|=1),r.length>1&&(n|=2),r.length===1&&(n|=4));let a={detectedAdFormats:r};return n>0&&(a.adTargetingErrorCode=n),{adTarget:e,diagnostics:a}},"getAdFormatsTargeting");var $e=i(o=>o.readyState==="interactive"||o.readyState==="complete","isDocumentReady"),We=i((o,t=2e3)=>S(void 0,null,function*(){let{crossOriginIframe:e,sameOriginIframe:r,sameOriginIframeDocument:n}=o;return e!=null?"cross-origin":r==null?"no-iframe":$e(n)?"prev-ready":yield new Promise(a=>{let c=i(()=>{let f;try{f=$e(n)}catch(h){m("error");return}f&&m("state-change")},"listener"),m=i(f=>{try{n.removeEventListener("readystatechange",c)}catch(h){}a(f)},"cleanupAndResolve");try{n.addEventListener("readystatechange",c)}catch(f){a("error")}setTimeout(()=>m("timeout"),t)})}),"waitForIFrameReadyState");var Nr=[],et=class{constructor(){l(this,"plugins",{overrideCustomAdFormats:i(()=>[],"overrideCustomAdFormats")});l(this,"_getAdFormatsTargeting",He);l(this,"_waitForIFrameReadyState",We)}_getAdFormats(){var t;return(t=this.plugins.overrideCustomAdFormats()[0])!=null?t:Nr}_encodeDetectedAdFormats(t){return t.map(e=>e.id).reduce((e,r)=>e|r,0)}_detectAdFormatInHtml(t,e){var r;return e==null?null:(r=t.find(n=>n.detectInHtml(e)))!=null?r:null}detectCustomAdFormat(t,e){return S(this,null,function*(){var y,st,W,D,K;let r=this._getAdFormats(),n=this._detectAdFormatInHtml(r,e.html),a=Date.now(),c;n!=null&&(c=yield this._waitForIFrameReadyState(t));let m=Date.now()-a,{adTarget:f,diagnostics:h}=this._getAdFormatsTargeting(r,(st=(y=t.sameOriginIframeDocument)!=null?y:t.slotElement)!=null?st:null);return this.core.get(O).fireEvent("detect-custom-ad-format",{cd120:c,cd130:(W=n==null?void 0:n.name)!=null?W:"default",cd131:(K=(D=h.detectedAdFormats[0])==null?void 0:D.name)!=null?K:"default",cm120:m},{sampleInterval:100,spoofWrapperId:!0}),f==null?null:wt(at(at({},f),h),{detectedAdFormats:this._encodeDetectedAdFormats(h.detectedAdFormats)})})}};i(et,"CustomAdFormats"),et=s([g],et);var rt=class{constructor(){l(this,"deduplicationSet",new b);l(this,"deduplicationReliable",new b)}_setDeduplicationTargeting(t){this.core.get(A).setSlotTargeting(t,{dv_upt_cwm:["0"]}),this.deduplicationSet.set(t,!0)}_onAdRequested(t){this.deduplicationReliable.set(t,this.deduplicationSet.get(t)===!0)}isDeduplicationReliable(t){return this.deduplicationReliable.get(t)===!0}};i(rt,"DuplicateMeasurement"),s([p(T,"slotDiscovered")],rt.prototype,"_setDeduplicationTargeting",1),s([p(v,"adRequested")],rt.prototype,"_onAdRequested",1),rt=s([g],rt);var it=class extends I{_isEligibleForMeasurement(t){return t.adServer==="custom"||t.adServer==="ast"||this.core.get(U).isAdServerConfigured(t.adUnit.network)}_isReadyForMeasurement(t){return this._isEligibleForMeasurement(t)&&(t.adServer==="custom"||this.core.get(rt).isDeduplicationReliable(t))}_onSlotDiscovered(t){this._isEligibleForMeasurement(t)&&(this.core.get(P).setIdentifiers(t),this.core.get(P).setConstants(t),this.core.get(P).setAdUnit(t))}_onAdRequested(t){this._isEligibleForMeasurement(t)&&(this.core.get(P).setCustomDimensions(t),this.core.get(P).setQualityTargeting(t))}_onAdRendered(t,e,r){return S(this,null,function*(){if((e==null?void 0:e.type)!=="display"||!this._isReadyForMeasurement(t))return;this.core.get(P).setAdInstance(t,e),this.core.get(P).setEngagement(t),this.core.get(P).setAdLocation(t,r),this.core.get(P).setDebug(t);let n=yield this.core.get(et).detectCustomAdFormat(r,e);this.core.get(P).setCustomAdFormat(t,n);let a=this.core.get(P).createScriptElement(t,r);this.core.get(H).increment(),this.core.get(ct).injectScriptElement(t,a)})}_onAdRemoved(t){this.core.get(H).decrement(),this.core.get(ct).removeScriptElement(t)}};i(it,"GptMeasurement"),s([p(T,"slotDiscovered")],it.prototype,"_onSlotDiscovered",1),s([p(v,"adRequestedOrInferred")],it.prototype,"_onAdRequested",1),s([p(v,"adRendered")],it.prototype,"_onAdRendered",1),s([p(v,"adRemoved")],it.prototype,"_onAdRemoved",1),it=s([g,N(M),N(tt)],it);var Xe=i(o=>o,"asStrictString"),Je=i(o=>o,"castAsStrictString");var Ze=i(()=>{let o;try{o=crypto.randomUUID()}catch(t){o=String(Math.random()*1e12)}return o},"getRandomId");var Mr=i(o=>{var t;return(t=o.ownerDocument)!=null?t:o},"getDocument");var tr=i((o,t)=>Mr(t).evaluate(o,t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),"getAllNodesByXpath"),er=i((o,t)=>tr(o,t).iterateNext()!=null,"hasXpathMatches"),kr=i(o=>(o==null?void 0:o.nodeType)===Node.ELEMENT_NODE?o:null,"nodeToElement");var rr=i((o,t)=>{let e=[],r=tr(o,t),n=r.iterateNext();for(;n!=null;){let a=kr(n);a!=null&&e.push(a),n=r.iterateNext()}return e},"getAllElementsByXpath");var Lr="celtra-ad-v",ir=`.//div[contains(concat(' ', @class), ' ${Lr}')]`,Fr=/<div[^>]*class\s*=\s*(['"])(?:(?:(?!\1)\S)+\s+)*\s*celtra-ad-v/,or="data-dv-id",Qr=i(o=>{let t=o;return t.celtra!=null&&t.celtra.viewabilityObservee!=null},"isCeltraElement"),nr={name:"Celtra",id:2,detect:i(o=>er(ir,o),"detect"),detectInHtml:i(o=>Fr.test(o),"detectInHtml"),target:i(o=>{try{let t=rr(ir,o);if(t.length!==1)return null;let e=t[0],r=Ze();Gr(e,r);let n=`^${r}$`;return{btreg:Je(n),btattb:Xe(or)}}catch(t){return null}},"target")},Vr=i((o,t)=>Qr(o)?(o.celtra.viewabilityObservee.setAttribute(or,t),!0):!1,"tryAddTargetingInfo"),Gr=i((o,t,e=100,r=200)=>{let n=0,a=i(()=>{Vr(o,t)||n>=e||(n++,setTimeout(a,r))},"attempt");a()},"addTargetingInfo");var Ct=class{_overrideCustomAdFormats(){return[nr]}};i(Ct,"NbcuConfig"),s([p(et,"overrideCustomAdFormats")],Ct.prototype,"_overrideCustomAdFormats",1),Ct=s([g],Ct);var sr=i((o,t=!0)=>{let e=document.createElement("script");return e.setAttribute("src",o),t&&e.setAttribute("async",""),e},"createScriptElement");var Tt=i(()=>{var o,t,e;return Math.floor((e=(t=(o=window.performance)==null?void 0:o.now)==null?void 0:t.call(o))!=null?e:Date.now())},"perfNowOrDateNow");var pe=class pe{constructor(){l(this,"_firstQueuedAdRequest",1/0);l(this,"_lastQueuedAdRequest",-1/0);l(this,"_firstReleasedAdRequest",1/0);l(this,"_lastReleasedAdRequest",-1/0);l(this,"_lastReleasedAdRequestTime",null);l(this,"_hasBeenSuccessful",!1)}setAdRequestQueued(t){this._firstQueuedAdRequest=Math.min(this._firstQueuedAdRequest,t),this._lastQueuedAdRequest=Math.max(this._lastQueuedAdRequest,t)}setAdRequestReleased(t){this._firstReleasedAdRequest=Math.min(this._firstReleasedAdRequest,t),this._lastReleasedAdRequest=Math.max(this._lastReleasedAdRequest,t),this._lastReleasedAdRequestTime=Tt()}getLastQueuedAdRequest(){return Number.isFinite(this._lastQueuedAdRequest)?this._lastQueuedAdRequest:null}getLastReleasedAdRequest(){return Number.isFinite(this._lastReleasedAdRequest)?this._lastReleasedAdRequest:null}getLastReleasedAdRequestTime(){return this._lastReleasedAdRequestTime}getLastSuccessfulAdRequest(){let t=Math.max(this._firstQueuedAdRequest,this._firstReleasedAdRequest),e=Math.min(this._lastQueuedAdRequest,this._lastReleasedAdRequest);return e<t?null:e}getPreviouslySuccessful(){return this._hasBeenSuccessful}markAdServerAdRequest(){this.getLastSuccessfulAdRequest()!=null&&(this._hasBeenSuccessful=!0),this._firstQueuedAdRequest=1/0,this._lastQueuedAdRequest=-1/0,this._firstReleasedAdRequest=1/0,this._lastReleasedAdRequest=-1/0,this._lastReleasedAdRequestTime=null}};i(pe,"SlotAdRequestTracker");var Yt=pe;var Kt=(c=>(c.UNKNOWN="UNKNOWN",c.SEEN="SEEN",c.NOT_READY="NOT_READY",c.POSSIBLE_TIMEOUT="POSSIBLE_TIMEOUT",c.PREV_READY="PREV_READY",c.READY="READY",c))(Kt||{});var fe="dv_upt_slot_ready",Br=["https://securepubads.g.doubleclick.net/gampad/ads?","https://pagead2.googlesyndication.com/gampad/ads?"],jr=750,q=class{constructor(){l(this,"plugins",{onSlotRequested:i(()=>[],"onSlotRequested"),onSlotRequestValidated:i(()=>[],"onSlotRequestValidated")});l(this,"validateAdRequests",!1);l(this,"lastAdRequestQueued",null);l(this,"lastAdRequestReleased",null);l(this,"state",{adRequestTracker:new b,triggered:new b})}_getSlotAdRequestTracker(t){return this.state.adRequestTracker.getOrDefaultFromFunction(t,()=>new Yt)}_onAdRequestQueued({index:t}){this.lastAdRequestQueued=t;for(let e of this.core.get(T).getSlots())this._getSlotAdRequestTracker(e).setAdRequestQueued(t),this.state.triggered.set(e,!1)}_onAdRequestBeforeRelease({index:t}){let e=this.core.get(A);this.lastAdRequestReleased=t;for(let r of this.core.get(T).getSlots())this._getSlotAdRequestTracker(r).setAdRequestReleased(t),this.validateAdRequests&&e.setSlotTargeting(r,{[fe]:["1"]})}_onSlotDiscovered(t,e){e===0&&this.lastAdRequestQueued!=null&&this._getSlotAdRequestTracker(t).setAdRequestQueued(this.lastAdRequestQueued)}_determineReadyState(t){let e=this._getSlotAdRequestTracker(t),r=e.getLastQueuedAdRequest(),n=e.getLastSuccessfulAdRequest(),a=e.getPreviouslySuccessful();return n!=null?"READY":a?"PREV_READY":r!=null?"NOT_READY":Date.now()-t.creationTime>jr?"SEEN":"UNKNOWN"}getSlotReadyStateOnAdServerAdRequest(t){let e=this._determineReadyState(t);if(e==="READY"){if(this.state.triggered.get(t)===!0)return{readyState:"PREV_READY"};this.state.triggered.set(t,!0);let r=this._getSlotAdRequestTracker(t).getLastReleasedAdRequestTime();return{readyState:e,readyFor:Tt()-r}}return{readyState:e}}_onSlotRequested(t){let{readyState:e,readyFor:r}=this.getSlotReadyStateOnAdServerAdRequest(t);this._getSlotAdRequestTracker(t).markAdServerAdRequest(),this.validateAdRequests&&this.core.get(A).setSlotTargeting(t,{[fe]:["0"]}),this.plugins.onSlotRequested(t,e,r)}enableAdRequestValidation(){if(!this.validateAdRequests)try{let t=this._processResourceRequest.bind(this);new PerformanceObserver(r=>r.getEntries().forEach(t)).observe({type:"resource"}),this.validateAdRequests=!0}catch(t){}}_processResourceRequest(t){var e,r,n;try{if(Br.every(m=>!t.name.startsWith(m)))return;let c=(r=(e=new URL(t.name).searchParams.get("prev_scp"))==null?void 0:e.split("|"))!=null?r:[];for(let m of c){let h=((n=new URLSearchParams(m).get(fe))==null?void 0:n[0])==="1";this.plugins.onSlotRequestValidated(h)}}catch(a){}}};i(q,"SlotReadinessTracker"),s([p(R,"adRequestQueued")],q.prototype,"_onAdRequestQueued",1),s([p(R,"adRequestBeforeRelease"),p(R,"adRequestTimedOut")],q.prototype,"_onAdRequestBeforeRelease",1),s([p(T,"slotDiscovered")],q.prototype,"_onSlotDiscovered",1),s([p(v,"adRequested")],q.prototype,"_onSlotRequested",1),q=s([g],q);var he="__dvtag_debug_mode",ar="1",j=class{constructor(){l(this,"enabled",!1);l(this,"debugScriptLoaded",i(t=>{},"debugScriptLoaded"));l(this,"debugScriptLoadedPromise",new Promise(t=>{this.debugScriptLoaded=t}))}_initialize(){try{this.enabled=window===window.top&&this.core.window.sessionStorage.getItem(he)===ar}catch(t){}this.enabled&&(this.core.get(R).delayAdRequests(this.debugScriptLoadedPromise),this._loadDebugScript())}_toggleDebugMode(){return S(this,null,function*(){this.enabled?this.core.window.sessionStorage.removeItem(he):this.core.window.sessionStorage.setItem(he,ar),this.core.window.location.reload()})}_onDebugScriptLoaded(){this.debugScriptLoaded(void 0)}_loadDebugScript(){return S(this,null,function*(){let{ctx:t,cmp:e}=this.core.get(_).getTagInfo(),{document:r}=this.core.window,n=sr(`https://pub.doubleverify.com/dvtag/${t}/${e}/debug.js`,!0);r.readyState==="loading"&&(yield new Promise(a=>r.addEventListener("DOMContentLoaded",()=>a(void 0)))),r.head.appendChild(n)})}_onAdRequestEvent(t){var e;(e=window.dvtagDebug)==null||e.adRequestEvent(t)}};i(j,"DebugScriptLoader"),s([x],j.prototype,"_initialize",1),s([lt("toggleDebugMode")],j.prototype,"_toggleDebugMode",1),s([lt("_debugScriptLoaded")],j.prototype,"_onDebugScriptLoaded",1),s([p(R,"adRequestQueued"),p(R,"adRequestBeforeRelease"),p(R,"adRequestTimedOut")],j.prototype,"_onAdRequestEvent",1),j=s([N(q),g],j);var Se="qt_loaded",zt="pts_pid",lr="pts_sid";var Te=i(o=>[...new Set(o.filter(De).map(t=>t.toLowerCase()))],"getGreenlightSignal");var ot=class extends I{_autoInsertPageId(){this.core.get(A).setGlobalTargeting({[zt]:[this.core.get(_).getVisitUuid()]})}_autoInsertSlotId(t){this.core.get(A).setSlotTargeting(t,{[lr]:[t.uuid]})}_autoInsertGlobalTargeting(t){this.core.get(A).setGlobalTargeting({[Se]:Te(Object.keys(t))},!0)}_autoInsertSlotTargeting(t,e){this.core.get(A).setSlotTargeting(t,{[Se]:Te(Object.keys(e))},!0)}};i(ot,"SignalsAutoInsertion"),s([p(_,"newVisit")],ot.prototype,"_autoInsertPageId",1),s([p(T,"slotDiscovered")],ot.prototype,"_autoInsertSlotId",1),s([p(E,"userTargetingUpdated"),p(E,"pageTargetingUpdated")],ot.prototype,"_autoInsertGlobalTargeting",1),s([p(E,"slotTargetingUpdated")],ot.prototype,"_autoInsertSlotTargeting",1),ot=s([g,N(M),N(j)],ot);var Yr=zt,$=class{constructor(){l(this,"restoreCount",0)}getRestoreCount(){return this.restoreCount}_restoreTargeting(){let t=this.core.get(A);for(let e of this.core.get(T).getSlots())t.getAdServerTargeting(e,Yr).length===0&&(t.setAdServerTargeting(e),this.restoreCount+=1)}};i($,"TargetingRestorer"),s([p(R,"adRequestQueued")],$.prototype,"_restoreTargeting",1),$=s([g],$);var Ae=class Ae{constructor(){l(this,"total",0);l(this,"dataPoints",0)}push(t){return this.total+=t,this.dataPoints+=1,this}get(){return this.total/this.dataPoints}getRounded(){return Math.round(this.get())}};i(Ae,"Average");var kt=Ae;var Kr="implcheck",zr=1e-4,Hr=5e3,$r=5,Y=class{constructor(){l(this,"enabled",!1);l(this,"totalInternalAdRequestQueuedCount",0);l(this,"totalAdRequestsCompletedCount",0);l(this,"totalSlotsRequestedCount",0);l(this,"totalSlotsRequestedOkCount",0);l(this,"totalTimeoutCount",0);l(this,"trackersSent",0);l(this,"totalValidatedAdServerRequests",{ok:0,notOk:0});l(this,"lastOnDvtagReadyCall",NaN);l(this,"slotReqAvgTimeSinceCall",new kt);l(this,"slotReqAvgTimeSinceDone",new kt);l(this,"batch",null)}isDebugForceEnabled(){return!1}_initialize(){this.enabled=this.core.get(Y).isDebugForceEnabled()||Math.random()<zr,this.enabled&&this.core.get(q).enableAdRequestValidation()}_onAdRequestQueued(t){this.enabled&&(this.lastOnDvtagReadyCall=Tt(),t.internal&&(this.totalInternalAdRequestQueuedCount+=1))}_onAdRequestCompleted(t){this.enabled&&(this.totalAdRequestsCompletedCount+=1,(t.status==="tag-timeout"||t.status==="queue-timeout")&&(this.totalTimeoutCount+=1))}_onSlotRequested(t,e,r){if(!this.enabled)return;let n=this._getOrStartBatch();this.totalSlotsRequestedCount+=1,e==="READY"&&(this.totalSlotsRequestedOkCount+=1),n.slots[e].push(t.elementId),r!=null&&(this.slotReqAvgTimeSinceDone.push(r),this.slotReqAvgTimeSinceCall.push(Tt()-this.lastOnDvtagReadyCall));let a=this._validateAdServerTargeting(t);a===1?n.targeting.extendedCount+=1:a===0&&(n.targeting.reducedCount+=1)}_validateAdServerTargeting(t){let e=this.core.get(A),r=2,n=e.getTargeting(t);for(let[a,c]of Object.entries(n)){let m=e.getAdServerTargeting(t,a);if(c.length>m.length||c.some(f=>!m.includes(f)))return 0;m.length>c.length&&(r=1)}return r}_onSlotRequestValidated(t){t?this.totalValidatedAdServerRequests.ok+=1:this.totalValidatedAdServerRequests.notOk+=1}_sendTracker(){let t=this.core.get($).getRestoreCount(),{slots:e,targeting:r,start:n}=this._getOrStartBatch(),a={cd110:e.READY.join(),cd111:e.PREV_READY.join(),cd112:e.SEEN.join(),cd113:e.NOT_READY.join(),cd114:e.UNKNOWN.join(),cd115:e.POSSIBLE_TIMEOUT.join(),cm106:this.trackersSent,cm107:n,cm109:this.totalTimeoutCount,cm110:this.slotReqAvgTimeSinceCall.getRounded(),cm111:this.slotReqAvgTimeSinceDone.getRounded(),cm112:this.totalSlotsRequestedOkCount,cm113:this.totalValidatedAdServerRequests.ok,cm114:this.totalValidatedAdServerRequests.notOk,cm115:t,cm116:this.totalAdRequestsCompletedCount,cm117:this.totalInternalAdRequestQueuedCount,cm118:this.totalSlotsRequestedCount,cm119:r.reducedCount,cm120:r.extendedCount};this.core.get(O).fireEvent(Kr,a),this.batch=null,this.trackersSent+=1,this.trackersSent>=$r&&(this.enabled=!1)}_getOrStartBatch(){return this.batch==null&&(this.batch={start:Tt(),slots:Object.fromEntries(Object.values(Kt).map(t=>[t,[]])),targeting:{extendedCount:0,reducedCount:0}},setTimeout(()=>this._sendTracker(),Hr)),this.batch}};i(Y,"ImplementationValidator"),s([x],Y.prototype,"_initialize",1),s([p(R,"adRequestQueued")],Y.prototype,"_onAdRequestQueued",1),s([p(R,"adRequestCompleted")],Y.prototype,"_onAdRequestCompleted",1),s([p(q,"onSlotRequested")],Y.prototype,"_onSlotRequested",1),s([p(q,"onSlotRequestValidated")],Y.prototype,"_onSlotRequestValidated",1),Y=s([g],Y);var nt=class{_defineSlot(t,e={}){if(typeof t!="string"||e==null||typeof e!="object")return;let r={id:L(e.id),network:L(e.network),sizes:e.sizes!=null?xt(e.sizes):void 0,position:L(e.position)};this.core.get(T).createSlot("custom",0,t,r)}_adRendered(t,e){if(typeof t!="string"||e==null||typeof e!="object")return;let r=this.core.get(T).getSlot("custom",t);if(r==null)return;let n={type:"display",advertiserId:L(e.advertiserId),campaignId:L(e.campaignId),creativeId:L(e.creativeId),lineItemId:L(e.lineItemId),renderedSize:jt(e.renderedSize)};this.core.get(v).setAdRendered(r,n)}_getTargeting(t){let e=this.core.get(A);if(typeof t!="string")return e.getTargeting();let r=this.core.get(T).getSlot("custom",t);return e.getTargeting(r)}};i(nt,"CustomAdServer"),s([lt("defineSlot")],nt.prototype,"_defineSlot",1),s([lt("getTargeting")],nt.prototype,"_getTargeting",1),nt=s([g],nt);var gt=class{constructor(){l(this,"initialized",!1);l(this,"size",0)}_initialize(){return S(this,null,function*(){if(yield Promise.resolve(),this.initialized)return;this.initialized=!0,this.core.dvtag.cmd instanceof Array||(this.core.dvtag.cmd=[]);let t=this.core.dvtag.cmd;this.core.dvtag.cmd={push:i((...e)=>{for(let r of e)try{r()}catch(n){}return this.size+=e.length,this.size},"push")},this.core.dvtag.cmd.push(...t)})}};i(gt,"CommandBuffer"),s([x],gt.prototype,"_initialize",1),gt=s([g],gt);var Pt=class{};i(Pt,"HouseHold"),Pt=s([g,N(R),N(gt),N(O),N(nt),N($)],Pt);if(window.dvtag==null||window.dvtag._core==null)try{new Ut(ee,window)}catch(o){}})();
